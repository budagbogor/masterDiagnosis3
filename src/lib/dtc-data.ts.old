// Data DTC dari sumber terpercaya

export interface DTCCode {
  code: string
  system: string
  subSystem: string
  description: string
  severity: string
  symptoms: string[]
  possibleCauses: string[]
  relatedSensors: string[]
  relatedActuators: string[]
  commonVehicles: string[]
  repairSteps: string[]
  estimatedCost?: string
  referenceSource: string[]
}

export const DTC_DATABASE: DTCCode[] = [
  {
    code: "P0300",
    system: "P",
    subSystem: "Ignition System / Misfire",
    description: "Random/Multiple Cylinder Misfire Detected",
    severity: "High",
    symptoms: [
      "Mesin bergetar saat idle",
      "Tenaga turun",
      "Konsumsi BBM boros"
    ],
    possibleCauses: [
      "Busi aus atau salah ganti",
      "Ignition coil rusak"
    ],
    relatedSensors: [
      "Crankshaft Position Sensor",
      "MAF Sensor"
    ],
    relatedActuators: [
      "Ignition Coils",
      "Fuel Injectors"
    ],
    commonVehicles: [
      "Semua kendaraan bensin"
    ],
    repairSteps: [
      "Scan OBD untuk konfirmasi",
      "Cek atau ganti busi"
      "Test ignition coils"
    ],
    estimatedCost: "Rp 200.000 - 5.000.000",
    referenceSource: ["OBD-II Standard", "Service Manual"]
  }
]

export function searchDTC(query: string): DTCCode[] {
  const normalizedQuery = query.toUpperCase().trim()
  if (!normalizedQuery) return []
  
  const exactMatch = DTC_DATABASE.filter(dtc => dtc.code === normalizedQuery)
  if (exactMatch.length > 0) return exactMatch
  
  const partialMatch = DTC_DATABASE.filter(dtc => dtc.code.includes(normalizedQuery))
  if (partialMatch.length > 0) return partialMatch
  
  return []
}

export function getDTCByCode(code: string): DTCCode | undefined {
  return DTC_DATABASE.find(dtc => dtc.code.toUpperCase() === code.toUpperCase().trim())
}

export function getAvailableSystems(): any[] {
  return [
    { system: "P", count: 1, description: "Powertrain" }
  ]
}
